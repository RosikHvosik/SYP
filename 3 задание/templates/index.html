<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ETL Producer - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Kafka</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: Arial; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        h1 { color: #333; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        textarea { min-height: 100px; font-family: monospace; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:disabled { background: #ccc; }
        .message { margin-top: 20px; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid #ddd; }
        .tab { padding: 10px 20px; cursor: pointer; border-bottom: 3px solid transparent; }
        .tab.active { border-bottom-color: #4CAF50; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>TL Producer - –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Kafka</h1>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('manual')">‚úçÔ∏è –†—É—á–Ω–æ–π –≤–≤–æ–¥</div>
            <div class="tab" onclick="switchTab('csv')">üìÑ CSV —Ñ–∞–π–ª</div>
            <div class="tab" onclick="switchTab('json')">üìã JSON —Ñ–∞–π–ª</div>
        </div>
        
        <form id="dataForm">
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã:</label>
                <input type="text" id="table_name" value="students" required>
                <small>–¢–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ _</small>
            </div>
            
            <div class="form-group">
                <label>–°—Ç–æ–ª–±—Ü—ã (JSON):</label>
                <textarea id="columns" required>
[
    {"name": "id", "type": "integer"},
    {"name": "name", "type": "text"},
    {"name": "age", "type": "integer"},
    {"name": "score", "type": "float"},
    {"name": "active", "type": "boolean"},
    {"name": "birthday", "type": "date"}
]</textarea>
                <small>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã: text, integer, float, boolean, date</small>
            </div>
            
            <div id="manualTab" class="tab-content">
                <div class="form-group">
                    <label>–î–∞–Ω–Ω—ã–µ (JSON):</label>
                    <textarea id="data">
[
    {"id": 1, "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤", "age": 20, "score": 85.5, "active": true, "birthday": "2003-05-15"},
    {"id": 2, "name": "–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–∞", "age": 21, "score": 92.0, "active": true, "birthday": "2002-08-22"},
    {"id": 3, "name": "–ê–ª–µ–∫—Å–µ–π –°–∏–¥–æ—Ä–æ–≤", "age": 22, "score": 78.3, "active": false, "birthday": "2001-11-30"}
]</textarea>
                </div>
            </div>
            
            <div id="csvTab" class="tab-content" style="display: none;">
                <div class="form-group">
                    <label>CSV —Ñ–∞–π–ª:</label>
                    <input type="file" id="csv_file" accept=".csv,.txt">
                    <small>–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ - –∑–∞–≥–æ–ª–æ–≤–∫–∏. –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å: –∑–∞–ø—è—Ç–∞—è, —Ç–æ—á–∫–∞ —Å –∑–∞–ø—è—Ç–æ–π –∏–ª–∏ —Ç–∞–±—É–ª—è—Ü–∏—è</small>
                </div>
            </div>
            
            <div id="jsonTab" class="tab-content" style="display: none;">
                <div class="form-group">
                    <label>JSON —Ñ–∞–π–ª:</label>
                    <input type="file" id="json_file" accept=".json">
                    <small>–§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤</small>
                </div>
            </div>
            
            <input type="hidden" id="data_type" value="manual">
            
            <button type="button" onclick="sendData()" id="sendBtn">üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Kafka</button>
        </form>
        
        <div id="message" class="message"></div>
        
        <div style="margin-top: 30px; padding: 15px; background: #f8f9fa; border-radius: 4px;">
            <h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö:</h3>
            <p>–¢–∞–±–ª–∏—Ü–∞: <span id="previewTable">students</span></p>
            <p>–°—Ç–æ–ª–±—Ü–æ–≤: <span id="previewCols">6</span></p>
            <p>–°—Ç—Ä–æ–∫: <span id="previewRows">3</span></p>
            <p>–°—Ç–∞—Ç—É—Å Kafka: <span id="kafkaStatus">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</span></p>
        </div>
    </div>

    <script>
        let currentTab = 'manual';
        
        function switchTab(tabName) {
            currentTab = tabName;
            
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('manualTab').style.display = tabName === 'manual' ? 'block' : 'none';
            document.getElementById('csvTab').style.display = tabName === 'csv' ? 'block' : 'none';
            document.getElementById('jsonTab').style.display = tabName === 'json' ? 'block' : 'none';
            
            document.getElementById('data_type').value = tabName;
            
            updatePreview();
        }
        
        function updatePreview() {
            try {
                const columns = JSON.parse(document.getElementById('columns').value);
                document.getElementById('previewCols').textContent = columns.length;
                
                if (currentTab === 'manual') {
                    const data = JSON.parse(document.getElementById('data').value);
                    document.getElementById('previewRows').textContent = data.length;
                } else {
                    document.getElementById('previewRows').textContent = '?';
                }
                
                document.getElementById('previewTable').textContent = 
                    document.getElementById('table_name').value || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ';
            } catch(e) {
                document.getElementById('previewCols').textContent = '–æ—à–∏–±–∫–∞';
                document.getElementById('previewRows').textContent = '–æ—à–∏–±–∫–∞';
            }
        }
        
        document.getElementById('table_name').addEventListener('input', updatePreview);
        document.getElementById('columns').addEventListener('input', updatePreview);
        document.getElementById('data').addEventListener('input', updatePreview);
        
async function sendData() {
    const btn = document.getElementById('sendBtn');
    const messageDiv = document.getElementById('message');
    
    btn.disabled = true;
    btn.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
    messageDiv.className = 'message info';
    messageDiv.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Kafka...';
    
    try {
        const formData = new FormData();
        formData.append('table_name', document.getElementById('table_name').value);
        formData.append('columns', document.getElementById('columns').value);
        formData.append('data_type', currentTab);
        
        if (currentTab === 'manual') {
            formData.append('data', document.getElementById('data').value);
        } else if (currentTab === 'csv') {
            const file = document.getElementById('csv_file').files[0];
            if (!file) {
                throw new Error('–í—ã–±–µ—Ä–∏—Ç–µ CSV —Ñ–∞–π–ª');
            }
            formData.append('csv_file', file);
        } else if (currentTab === 'json') {
            const file = document.getElementById('json_file').files[0];
            if (!file) {
                throw new Error('–í—ã–±–µ—Ä–∏—Ç–µ JSON —Ñ–∞–π–ª');
            }
            formData.append('json_file', file);
        }
        
        const response = await fetch('/send', {
            method: 'POST',
            body: formData
        });
        
        if (response.ok) {
            messageDiv.className = 'message success';
            messageDiv.textContent = '–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Kafka!';
        } else {
            const errorText = await response.text();
            messageDiv.className = 'message error';
            messageDiv.textContent = `–û—à–∏–±–∫–∞: ${errorText}`;
        }
        
    } catch (error) {
        messageDiv.className = 'message error';
        messageDiv.textContent = `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`;
    } finally {
        btn.disabled = false;
        btn.textContent = '—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Kafka';
        updatePreview();
    }
}
        
        window.onload = function() {
            updatePreview();
            checkKafkaStatus();
        };
        
        async function checkKafkaStatus() {
            const statusEl = document.getElementById('kafkaStatus');
            try {
                const response = await fetch('/send', {
                    method: 'HEAD'
                });
                statusEl.textContent = '–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç';
                statusEl.style.color = 'green';
            } catch {
                statusEl.textContent = '–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
                statusEl.style.color = 'red';
            }
        }
    </script>
</body>
</html>
